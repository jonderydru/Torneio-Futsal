<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#004aad">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Torneio de Futsal DAEBAMES - Gerenciador Completo</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .team-card:hover { transform: translateY(-2px); }
        .match-card { transition: all 0.3s ease; }
        .match-card:hover { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-secondary { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .btn-success { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app" class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="bg-white rounded-lg shadow-md mb-6 p-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-futbol text-4xl text-blue-600"></i>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">Torneio DAEBAMES</h1>
                        <p class="text-gray-600">Gerenciador de Torneios de Futsal</p>
                    </div>
                </div>
                <div class="flex space-x-4">
                    <button onclick="exportData()" class="btn-secondary text-white px-4 py-2 rounded-lg hover:opacity-90">
                        <i class="fas fa-download mr-2"></i>Exportar
                    </button>
                    <button onclick="importData()" class="btn-primary text-white px-4 py-2 rounded-lg hover:opacity-90">
                        <i class="fas fa-upload mr-2"></i>Importar
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="bg-white rounded-lg shadow-md mb-6">
            <div class="flex flex-wrap">
                <button class="tab-btn active flex-1 px-6 py-4 text-center font-semibold text-blue-600 border-b-2 border-blue-600" onclick="showTab('dashboard')">
                    <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                </button>
                <button class="tab-btn flex-1 px-6 py-4 text-center font-semibold text-gray-600 hover:text-blue-600" onclick="showTab('groups')">
                    <i class="fas fa-users mr-2"></i>Grupos
                </button>
                <button class="tab-btn flex-1 px-6 py-4 text-center font-semibold text-gray-600 hover:text-blue-600" onclick="showTab('matches')">
                    <i class="fas fa-calendar-alt mr-2"></i>Jogos
                </button>
                <button class="tab-btn flex-1 px-6 py-4 text-center font-semibold text-gray-600 hover:text-blue-600" onclick="showTab('classification')">
                    <i class="fas fa-trophy mr-2"></i>Classificação
                </button>
                <button class="tab-btn flex-1 px-6 py-4 text-center font-semibold text-gray-600 hover:text-blue-600" onclick="showTab('statistics')">
                    <i class="fas fa-chart-bar mr-2"></i>Estatísticas
                </button>
            </div>
        </nav>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">Total de Times</p>
                            <p class="text-3xl font-bold text-blue-600" id="totalTeams">0</p>
                        </div>
                        <i class="fas fa-users text-blue-600 text-2xl"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">Jogos Disputados</p>
                            <p class="text-3xl font-bold text-green-600" id="playedMatches">0</p>
                        </div>
                        <i class="fas fa-futbol text-green-600 text-2xl"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">Jogos Restantes</p>
                            <p class="text-3xl font-bold text-orange-600" id="remainingMatches">0</p>
                        </div>
                        <i class="fas fa-clock text-orange-600 text-2xl"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">Total de Gols</p>
                            <p class="text-3xl font-bold text-purple-600" id="totalGoals">0</p>
                        </div>
                        <i class="fas fa-crosshairs text-purple-600 text-2xl"></i>
                    </div>
                </div>
            </div>

            <!-- Recent Matches -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-history mr-2 text-blue-600"></i>Últimos Resultados
                </h3>
                <div id="recentMatches" class="space-y-3">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- Next Matches -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-play mr-2 text-green-600"></i>Próximos Jogos
                </h3>
                <div id="nextMatches" class="space-y-3">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Groups Tab -->
        <div id="groups" class="tab-content">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-users mr-2 text-blue-600"></i>Gerenciar Grupos
                    </h3>
                    <button onclick="showAddGroupModal()" class="btn-primary text-white px-4 py-2 rounded-lg hover:opacity-90">
                        <i class="fas fa-plus mr-2"></i>Novo Grupo
                    </button>
                </div>
                <div id="groupsList" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- Add Team to Group -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h4 class="text-lg font-semibold text-gray-800 mb-4">
                    <i class="fas fa-user-plus mr-2 text-green-600"></i>Adicionar Time
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <select id="selectGroupForTeam" class="border rounded-lg px-3 py-2">
                        <option value="">Selecione o Grupo</option>
                    </select>
                    <input id="newTeamName" type="text" placeholder="Nome do Time" class="border rounded-lg px-3 py-2">
                    <button onclick="addTeamToGroup()" class="btn-success text-white px-4 py-2 rounded-lg hover:opacity-90">
                        <i class="fas fa-plus mr-2"></i>Adicionar
                    </button>
                </div>
            </div>
        </div>

        <!-- Matches Tab -->
        <div id="matches" class="tab-content">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-calendar-alt mr-2 text-blue-600"></i>Gerenciar Jogos
                    </h3>
                    <button onclick="showAddMatchModal()" class="btn-primary text-white px-4 py-2 rounded-lg hover:opacity-90">
                        <i class="fas fa-plus mr-2"></i>Novo Jogo
                    </button>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button onclick="filterMatches('all')" class="filter-btn active bg-blue-600 text-white px-4 py-2 rounded-lg">Todos</button>
                        <button onclick="filterMatches('pending')" class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300">Pendentes</button>
                        <button onclick="filterMatches('played')" class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300">Jogados</button>
                    </div>
                    <div id="matchesList" class="space-y-4">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Classification Tab -->
        <div id="classification" class="tab-content">
            <div id="classificationContent">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Statistics Tab -->
        <div id="statistics" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-chart-bar mr-2 text-blue-600"></i>Gols por Grupo
                    </h3>
                    <div style="height: 400px;">
                        <canvas id="goalsChart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-chart-pie mr-2 text-green-600"></i>Vitórias por Time
                    </h3>
                    <div style="height: 400px;">
                        <canvas id="winsChart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-crown mr-2 text-yellow-600"></i>Artilheiros
                    </h3>
                    <div id="topScorers" class="space-y-2">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-shield-alt mr-2 text-red-600"></i>Defesas Menos Vazadas
                    </h3>
                    <div id="bestDefenses" class="space-y-2">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Group Modal -->
    <div id="addGroupModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Criar Novo Grupo</h3>
                <button onclick="closeModal('addGroupModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <input id="newGroupName" type="text" placeholder="Nome do Grupo (ex: Grupo A)" class="w-full border rounded-lg px-3 py-2">
                <div class="flex justify-end space-x-2">
                    <button onclick="closeModal('addGroupModal')" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Cancelar</button>
                    <button onclick="createGroup()" class="btn-primary text-white px-4 py-2 rounded-lg hover:opacity-90">Criar Grupo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Match Modal -->
    <div id="addMatchModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Criar Novo Jogo</h3>
                <button onclick="closeModal('addMatchModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <select id="matchTeam1" class="w-full border rounded-lg px-3 py-2">
                    <option value="">Selecione Time 1</option>
                </select>
                <select id="matchTeam2" class="w-full border rounded-lg px-3 py-2">
                    <option value="">Selecione Time 2</option>
                </select>
                <input id="matchDate" type="datetime-local" class="w-full border rounded-lg px-3 py-2">
                <input id="matchLocation" type="text" placeholder="Local do jogo (opcional)" class="w-full border rounded-lg px-3 py-2">
                <div class="flex justify-end space-x-2">
                    <button onclick="closeModal('addMatchModal')" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Cancelar</button>
                    <button onclick="createMatch()" class="btn-primary text-white px-4 py-2 rounded-lg hover:opacity-90">Criar Jogo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Match Modal -->
    <div id="updateMatchModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Atualizar Resultado</h3>
                <button onclick="closeModal('updateMatchModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div class="text-center">
                    <p id="matchTeamsDisplay" class="text-lg font-semibold text-gray-800"></p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center">
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="team1Label">Time 1</label>
                        <input id="team1Goals" type="number" min="0" class="w-full text-center text-2xl font-bold border rounded-lg px-3 py-2">
                    </div>
                    <div class="text-center">
                        <label class="block text-sm font-medium text-gray-700 mb-2" id="team2Label">Time 2</label>
                        <input id="team2Goals" type="number" min="0" class="w-full text-center text-2xl font-bold border rounded-lg px-3 py-2">
                    </div>
                </div>
                <div class="flex justify-end space-x-2">
                    <button onclick="closeModal('updateMatchModal')" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Cancelar</button>
                    <button onclick="updateMatchResult()" class="btn-success text-white px-4 py-2 rounded-lg hover:opacity-90">Salvar Resultado</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class TournamentManager {
            constructor() {
                this.groups = JSON.parse(localStorage.getItem('tournament_groups')) || {};
                this.matches = JSON.parse(localStorage.getItem('tournament_matches')) || [];
                this.currentMatchId = null;
                this.currentFilter = 'all';
                this.initialize();
            }

            initialize() {
                // Initialize with default data if empty
                if (Object.keys(this.groups).length === 0) {
                    this.createDefaultTournament();
                }
                this.updateUI();
            }

            createDefaultTournament() {
                // Create default groups with teams
                this.groups = {
                    'A': {
                        name: 'Grupo A',
                        teams: ['IB GETSÊMANI', 'IB MEMORIAL DE MESQUITA', 'PIB DE COSMORAMA', 'PIB DE MESQUITA']
                    },
                    'B': {
                        name: 'Grupo B',
                        teams: ['IB BOAS NOVAS', 'PIB CHATUBA', 'PIB DE EDSON PASSOS', 'IB BETEL']
                    }
                };
                this.generateGroupMatches();
                this.saveData();
            }

            generateGroupMatches() {
                // Generate all possible matches within each group
                Object.keys(this.groups).forEach(groupId => {
                    const teams = this.groups[groupId].teams;
                    for (let i = 0; i < teams.length; i++) {
                        for (let j = i + 1; j < teams.length; j++) {
                            this.matches.push({
                                id: Date.now() + Math.random(),
                                team1: teams[i],
                                team2: teams[j],
                                group: groupId,
                                goals1: null,
                                goals2: null,
                                date: null,
                                location: '',
                                played: false,
                                phase: 'group'
                            });
                        }
                    }
                });
            }

            saveData() {
                localStorage.setItem('tournament_groups', JSON.stringify(this.groups));
                localStorage.setItem('tournament_matches', JSON.stringify(this.matches));
            }

            // Group management
            createGroup(name) {
                const groupId = name.charAt(name.length - 1).toUpperCase();
                this.groups[groupId] = {
                    name: name,
                    teams: []
                };
                this.saveData();
                this.updateUI();
            }

            addTeamToGroup(groupId, teamName) {
                if (this.groups[groupId] && !this.groups[groupId].teams.includes(teamName)) {
                    this.groups[groupId].teams.push(teamName);
                    this.saveData();
                    this.updateUI();
                    return true;
                }
                return false;
            }

            removeTeamFromGroup(groupId, teamName) {
                if (this.groups[groupId]) {
                    this.groups[groupId].teams = this.groups[groupId].teams.filter(team => team !== teamName);
                    // Remove matches involving this team
                    this.matches = this.matches.filter(match => 
                        match.team1 !== teamName && match.team2 !== teamName
                    );
                    this.saveData();
                    this.updateUI();
                }
            }

            // Match management
            createMatch(team1, team2, date, location) {
                const match = {
                    id: Date.now() + Math.random(),
                    team1: team1,
                    team2: team2,
                    group: this.getTeamGroup(team1),
                    goals1: null,
                    goals2: null,
                    date: date,
                    location: location,
                    played: false,
                    phase: 'group'
                };
                this.matches.push(match);
                this.saveData();
                this.updateUI();
            }

            updateMatch(matchId, goals1, goals2) {
                const match = this.matches.find(m => m.id === matchId);
                if (match) {
                    match.goals1 = parseInt(goals1);
                    match.goals2 = parseInt(goals2);
                    match.played = true;
                    this.saveData();
                    this.updateUI();
                }
            }

            getTeamGroup(teamName) {
                for (let groupId in this.groups) {
                    if (this.groups[groupId].teams.includes(teamName)) {
                        return groupId;
                    }
                }
                return null;
            }

            // Statistics and calculations
            calculateTeamStats(teamName) {
                const stats = {
                    matches: 0,
                    wins: 0,
                    draws: 0,
                    losses: 0,
                    goalsFor: 0,
                    goalsAgainst: 0,
                    goalDifference: 0,
                    points: 0
                };

                this.matches.filter(match => match.played && (match.team1 === teamName || match.team2 === teamName))
                    .forEach(match => {
                        stats.matches++;
                        const isTeam1 = match.team1 === teamName;
                        const teamGoals = isTeam1 ? match.goals1 : match.goals2;
                        const opponentGoals = isTeam1 ? match.goals2 : match.goals1;

                        stats.goalsFor += teamGoals;
                        stats.goalsAgainst += opponentGoals;

                        if (teamGoals > opponentGoals) {
                            stats.wins++;
                            stats.points += 3;
                        } else if (teamGoals === opponentGoals) {
                            stats.draws++;
                            stats.points += 1;
                        } else {
                            stats.losses++;
                        }
                    });

                stats.goalDifference = stats.goalsFor - stats.goalsAgainst;
                return stats;
            }

            getGroupClassification(groupId) {
                if (!this.groups[groupId]) return [];
                
                return this.groups[groupId].teams.map(team => ({
                    team: team,
                    ...this.calculateTeamStats(team)
                })).sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;
                    if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
                    return b.goalsFor - a.goalsFor;
                });
            }

            getAllTeams() {
                const teams = [];
                Object.values(this.groups).forEach(group => {
                    teams.push(...group.teams);
                });
                return teams;
            }

            // UI Updates
            updateUI() {
                this.updateDashboard();
                this.updateGroupsList();
                this.updateMatchesList();
                this.updateClassification();
                this.updateStatistics();
                this.updateTeamSelects();
            }

            updateDashboard() {
                const totalTeams = this.getAllTeams().length;
                const playedMatches = this.matches.filter(m => m.played).length;
                const totalMatches = this.matches.length;
                const remainingMatches = totalMatches - playedMatches;
                const totalGoals = this.matches.filter(m => m.played)
                    .reduce((sum, m) => sum + (m.goals1 || 0) + (m.goals2 || 0), 0);

                document.getElementById('totalTeams').textContent = totalTeams;
                document.getElementById('playedMatches').textContent = playedMatches;
                document.getElementById('remainingMatches').textContent = remainingMatches;
                document.getElementById('totalGoals').textContent = totalGoals;

                // Recent matches
                const recentMatches = this.matches.filter(m => m.played)
                    .slice(-5).reverse();
                
                const recentMatchesHTML = recentMatches.map(match => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <div class="flex-1">
                            <span class="font-semibold">${match.team1}</span>
                            <span class="mx-2 text-lg font-bold">${match.goals1} x ${match.goals2}</span>
                            <span class="font-semibold">${match.team2}</span>
                        </div>
                        <span class="text-sm text-gray-600">Grupo ${match.group}</span>
                    </div>
                `).join('');

                document.getElementById('recentMatches').innerHTML = recentMatches.length ? 
                    recentMatchesHTML : '<p class="text-gray-500 text-center">Nenhum jogo disputado ainda</p>';

                // Next matches
                const nextMatches = this.matches.filter(m => !m.played).slice(0, 5);
                
                const nextMatchesHTML = nextMatches.map(match => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <div class="flex-1">
                            <span class="font-semibold">${match.team1}</span>
                            <span class="mx-2 text-gray-500">vs</span>
                            <span class="font-semibold">${match.team2}</span>
                        </div>
                        <div class="text-right">
                            <span class="text-sm text-gray-600">Grupo ${match.group}</span>
                            ${match.date ? `<div class="text-xs text-gray-500">${new Date(match.date).toLocaleString('pt-BR')}</div>` : ''}
                        </div>
                    </div>
                `).join('');

                document.getElementById('nextMatches').innerHTML = nextMatches.length ? 
                    nextMatchesHTML : '<p class="text-gray-500 text-center">Nenhum jogo pendente</p>';
            }

            updateGroupsList() {
                const groupsHTML = Object.keys(this.groups).map(groupId => {
                    const group = this.groups[groupId];
                    const teamsHTML = group.teams.map(team => `
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                            <span class="font-medium">${team}</span>
                            <button onclick="tournament.removeTeamFromGroup('${groupId}', '${team}')" 
                                    class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    `).join('');

                    return `
                        <div class="team-card bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="text-lg font-semibold text-gray-800">${group.name}</h4>
                                <span class="text-sm text-gray-600">${group.teams.length} times</span>
                            </div>
                            <div class="space-y-2">
                                ${teamsHTML || '<p class="text-gray-500 text-center">Nenhum time adicionado</p>'}
                            </div>
                        </div>
                    `;
                }).join('');

                document.getElementById('groupsList').innerHTML = groupsHTML;

                // Update group select for adding teams
                const selectHTML = '<option value="">Selecione o Grupo</option>' + 
                    Object.keys(this.groups).map(groupId => 
                        `<option value="${groupId}">${this.groups[groupId].name}</option>`
                    ).join('');
                
                document.getElementById('selectGroupForTeam').innerHTML = selectHTML;
            }

            updateMatchesList() {
                let matches = this.matches;
                
                // Apply filter
                if (this.currentFilter === 'pending') {
                    matches = matches.filter(m => !m.played);
                } else if (this.currentFilter === 'played') {
                    matches = matches.filter(m => m.played);
                }

                const matchesHTML = matches.map(match => {
                    const status = match.played ? 'Finalizado' : 'Pendente';
                    const statusColor = match.played ? 'text-green-600' : 'text-orange-600';
                    const score = match.played ? `${match.goals1} x ${match.goals2}` : 'vs';

                    return `
                        <div class="match-card bg-white border rounded-lg p-4 shadow-sm">
                            <div class="flex justify-between items-center">
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-sm text-gray-600">Grupo ${match.group}</span>
                                        <span class="text-sm ${statusColor} font-medium">${status}</span>
                                    </div>
                                    <div class="text-lg font-semibold text-center">
                                        <span>${match.team1}</span>
                                        <span class="mx-4 ${match.played ? 'text-blue-600 font-bold' : 'text-gray-500'}">${score}</span>
                                        <span>${match.team2}</span>
                                    </div>
                                    ${match.date ? `<div class="text-sm text-gray-500 text-center mt-1">${new Date(match.date).toLocaleString('pt-BR')}</div>` : ''}
                                    ${match.location ? `<div class="text-sm text-gray-500 text-center">${match.location}</div>` : ''}
                                </div>
                                <div class="ml-4">
                                    <button onclick="tournament.editMatch(${match.id})" 
                                            class="btn-primary text-white px-3 py-1 rounded text-sm hover:opacity-90">
                                        <i class="fas fa-edit mr-1"></i>${match.played ? 'Editar' : 'Resultado'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                document.getElementById('matchesList').innerHTML = matchesHTML || 
                    '<p class="text-gray-500 text-center">Nenhum jogo encontrado</p>';
            }

            updateClassification() {
                const classificationsHTML = Object.keys(this.groups).map(groupId => {
                    const group = this.groups[groupId];
                    const classification = this.getGroupClassification(groupId);

                    const tableHTML = classification.map((team, index) => `
                        <tr class="${index === 0 ? 'bg-yellow-50' : index < 2 ? 'bg-green-50' : ''}">
                            <td class="px-4 py-3 text-center font-semibold">${index + 1}º</td>
                            <td class="px-4 py-3 font-medium">${team.team}</td>
                            <td class="px-4 py-3 text-center">${team.matches}</td>
                            <td class="px-4 py-3 text-center text-green-600 font-semibold">${team.wins}</td>
                            <td class="px-4 py-3 text-center text-yellow-600">${team.draws}</td>
                            <td class="px-4 py-3 text-center text-red-600">${team.losses}</td>
                            <td class="px-4 py-3 text-center">${team.goalsFor}</td>
                            <td class="px-4 py-3 text-center">${team.goalsAgainst}</td>
                            <td class="px-4 py-3 text-center font-semibold ${team.goalDifference >= 0 ? 'text-green-600' : 'text-red-600'}">${team.goalDifference > 0 ? '+' : ''}${team.goalDifference}</td>
                            <td class="px-4 py-3 text-center font-bold text-blue-600">${team.points}</td>
                        </tr>
                    `).join('');

                    return `
                        <div class="bg-white rounded-lg shadow-md mb-6">
                            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-t-lg">
                                <h3 class="text-xl font-bold">
                                    <i class="fas fa-trophy mr-2"></i>${group.name}
                                </h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Pos</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Time</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">J</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">V</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">E</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">D</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">GP</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">GC</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">SG</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Pts</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        ${tableHTML}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                }).join('');

                document.getElementById('classificationContent').innerHTML = classificationsHTML;
            }

            updateStatistics() {
                // Goals by group chart
                const groupGoals = {};
                Object.keys(this.groups).forEach(groupId => {
                    groupGoals[groupId] = this.matches
                        .filter(m => m.played && m.group === groupId)
                        .reduce((sum, m) => sum + (m.goals1 || 0) + (m.goals2 || 0), 0);
                });

                if (window.goalsChart) window.goalsChart.destroy();
                const ctx1 = document.getElementById('goalsChart').getContext('2d');
                window.goalsChart = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(groupGoals).map(g => `Grupo ${g}`),
                        datasets: [{
                            label: 'Gols',
                            data: Object.values(groupGoals),
                            backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c'],
                            borderRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });

                // Wins by team chart
                const teamWins = {};
                this.getAllTeams().forEach(team => {
                    teamWins[team] = this.calculateTeamStats(team).wins;
                });

                if (window.winsChart) window.winsChart.destroy();
                const ctx2 = document.getElementById('winsChart').getContext('2d');
                window.winsChart = new Chart(ctx2, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(teamWins),
                        datasets: [{
                            data: Object.values(teamWins),
                            backgroundColor: [
                                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                                '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });

                // Top scorers and best defenses
                const teamStats = this.getAllTeams().map(team => ({
                    team: team,
                    ...this.calculateTeamStats(team)
                }));

                const topScorers = teamStats
                    .sort((a, b) => b.goalsFor - a.goalsFor)
                    .slice(0, 5);

                const topScorersHTML = topScorers.map((team, index) => `
                    <div class="flex justify-between items-center p-2 ${index === 0 ? 'bg-yellow-100' : 'bg-gray-50'} rounded">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">${index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `${index + 1}º`}</span>
                            <span class="font-medium">${team.team}</span>
                        </div>
                        <span class="font-bold text-blue-600">${team.goalsFor} gols</span>
                    </div>
                `).join('');

                const bestDefenses = teamStats
                    .sort((a, b) => a.goalsAgainst - b.goalsAgainst)
                    .slice(0, 5);

                const bestDefensesHTML = bestDefenses.map((team, index) => `
                    <div class="flex justify-between items-center p-2 ${index === 0 ? 'bg-green-100' : 'bg-gray-50'} rounded">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">${index === 0 ? '🛡️' : index === 1 ? '🥈' : index === 2 ? '🥉' : `${index + 1}º`}</span>
                            <span class="font-medium">${team.team}</span>
                        </div>
                        <span class="font-bold text-green-600">${team.goalsAgainst} gols sofridos</span>
                    </div>
                `).join('');

                document.getElementById('topScorers').innerHTML = topScorersHTML;
                document.getElementById('bestDefenses').innerHTML = bestDefensesHTML;
            }

            updateTeamSelects() {
                const teams = this.getAllTeams();
                const optionsHTML = '<option value="">Selecione</option>' + 
                    teams.map(team => `<option value="${team}">${team}</option>`).join('');
                
                document.getElementById('matchTeam1').innerHTML = optionsHTML;
                document.getElementById('matchTeam2').innerHTML = optionsHTML;
            }

            // Modal handlers
            editMatch(matchId) {
                const match = this.matches.find(m => m.id === matchId);
                if (match) {
                    this.currentMatchId = matchId;
                    document.getElementById('matchTeamsDisplay').textContent = `${match.team1} vs ${match.team2}`;
                    document.getElementById('team1Label').textContent = match.team1;
                    document.getElementById('team2Label').textContent = match.team2;
                    document.getElementById('team1Goals').value = match.goals1 || '';
                    document.getElementById('team2Goals').value = match.goals2 || '';
                    showModal('updateMatchModal');
                }
            }
        }

        // Initialize tournament manager
        const tournament = new TournamentManager();

        // Tab navigation
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'text-blue-600', 'border-b-2', 'border-blue-600');
                btn.classList.add('text-gray-600');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active', 'text-blue-600', 'border-b-2', 'border-blue-600');
            event.target.classList.remove('text-gray-600');
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            document.getElementById(modalId).classList.add('flex');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }

        function showAddGroupModal() {
            document.getElementById('newGroupName').value = '';
            showModal('addGroupModal');
        }

        function showAddMatchModal() {
            document.getElementById('matchTeam1').value = '';
            document.getElementById('matchTeam2').value = '';
            document.getElementById('matchDate').value = '';
            document.getElementById('matchLocation').value = '';
            showModal('addMatchModal');
        }

        // Group functions
        function createGroup() {
            const name = document.getElementById('newGroupName').value.trim();
            if (name) {
                tournament.createGroup(name);
                closeModal('addGroupModal');
            }
        }

        function addTeamToGroup() {
            const groupId = document.getElementById('selectGroupForTeam').value;
            const teamName = document.getElementById('newTeamName').value.trim();
            
            if (groupId && teamName) {
                if (tournament.addTeamToGroup(groupId, teamName)) {
                    document.getElementById('newTeamName').value = '';
                    alert('Time adicionado com sucesso!');
                } else {
                    alert('Este time já existe no grupo!');
                }
            }
        }

        // Match functions
        function createMatch() {
            const team1 = document.getElementById('matchTeam1').value;
            const team2 = document.getElementById('matchTeam2').value;
            const date = document.getElementById('matchDate').value;
            const location = document.getElementById('matchLocation').value.trim();
            
            if (team1 && team2 && team1 !== team2) {
                tournament.createMatch(team1, team2, date, location);
                closeModal('addMatchModal');
            } else {
                alert('Por favor, selecione dois times diferentes!');
            }
        }

        function updateMatchResult() {
            const goals1 = document.getElementById('team1Goals').value;
            const goals2 = document.getElementById('team2Goals').value;
            
            if (goals1 !== '' && goals2 !== '' && tournament.currentMatchId) {
                tournament.updateMatch(tournament.currentMatchId, goals1, goals2);
                closeModal('updateMatchModal');
            }
        }

        // Filter functions
        function filterMatches(filter) {
            tournament.currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-blue-600', 'text-white');
            tournament.updateMatchesList();
        }

        // Data export/import
        function exportData() {
            const data = {
                groups: tournament.groups,
                matches: tournament.matches,
                exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `torneio_daebames_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.groups && data.matches) {
                                tournament.groups = data.groups;
                                tournament.matches = data.matches;
                                tournament.saveData();
                                tournament.updateUI();
                                alert('Dados importados com sucesso!');
                            } else {
                                alert('Arquivo inválido!');
                            }
                        } catch (error) {
                            alert('Erro ao importar dados!');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('fixed')) {
                const modalId = e.target.id;
                closeModal(modalId);
            }
        });
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js')
      .then(reg => console.log('Service Worker registrado', reg))
      .catch(err => console.log('Erro ao registrar o Service Worker', err));
  }
    </script>
</body>
</html>